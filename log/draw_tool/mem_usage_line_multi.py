import numpy as np
import matplotlib.pyplot as plt

# 3
# 95
# docker-base-1/test_data/mem_usage.log
# 1578398142
# base
# docker-uksm-1/test_data/mem_usage.log
# 1578395838
# UKSM
# docker-pksm-1/test_data/mem_usage.log
# 1578396809
# PKSM-1




# ============================== 64 NGINX start ============================
# nginx_64_verbo.pdf
# dump.pdf
# 5
# 140
# nginx64-base/test_data/mem_usage.log
# 1578540814
# Base
# nginx64-uksm-2/test_data/mem_usage.log
# 1578546453
# UKSM
# nginx64-pksm50/test_data/mem_usage.log
# 1578541782
# CKSM-50
# nginx64-pksm100/test_data/mem_usage.log
# 1578543956
# CKSM-100
# nginx64-pksm200/test_data/mem_usage.log
# 1578541159
# CKSM-200
# ====================================================================

# dump.pdf
# 2
# 350
# nginx8-base/test_data/mem_usage.log
# 1578738289
# Base
# nginx8-pksm50/test_data/mem_usage.log
# 1578738099
# CKSM-50

# dump.pdf
# 3
# 350
# nginx16-base/test_data/mem_usage.log
# 1578739053
# Base
# nginx16-uksm/test_data/mem_usage.log
# 1578751011
# UKSM
# nginx16-pksm50-2/test_data/mem_usage.log
# 1578743261
# CKSM-50

# dump.pdf
# 3
# 350
# nginx128-base/test_data/mem_usage.log
# 1578729463
# Base
# nginx128-uksm/test_data/mem_usage.log
# 1578749354
# UKSM
# nginx128-pksm50/test_data/mem_usage.log
# 1578734303
# CKSM-50

# test.pdf
# 4
# 1000
# nginx256-base/test_data/mem_usage.log
# 1578730050
# Base
# nginx256-uksm/test_data/mem_usage.log
# 1578749910
# UKSM
# nginx256-pksm50/test_data/mem_usage.log
# 1578804727
# CKSM-50
# nginx256-pksm100/test_data/mem_usage.log
# 1578735346
# CKSM-100

# ============================== 32 NGINX start ============================
# dump.pdf
# 6
# 70
# nginx32-base-2/test_data/mem_usage.log
# 1578469302
# Base
# nginx32-uksm-2/test_data/mem_usage.log
# 1578469992
# UKSM
# nginx32-pksm50/test_data/mem_usage.log
# 1578543031
# CKSM-50
# nginx32-pksm100-1/test_data/mem_usage.log
# 1578470749
# CKSM-100
# nginx32-pksm-2/test_data/mem_usage.log
# 1578468899
# CKSM-200
# nginx32-pksm500-1/test_data/mem_usage.log
# 1578470491
# CKSM-500
# ====================================================================

# ============================== 64 Redis start ============================
# dump.pdf
# 3
# 120
# redis64-base/test_data/mem_usage.log
# 1578545206
# Base
# redis64-uksm/test_data/mem_usage.log
# 1578547003
# UKSM
# redis64-pksm200/test_data/mem_usage.log
# 1578545509
# CKSM-50
# ====================================================================

# dump.pdf
# 3
# 350
# httpd64-base/test_data/mem_usage.log
# 1578744021
# Base
# httpd64-uksm-2/test_data/mem_usage.log
# 1578753663
# UKSM
# httpd64-pksm50/test_data/mem_usage.log
# 1578743645
# CKSM-50

# dump.pdf
# 3
# 350
# postage64-base/test_data/mem_usage.log
# 1578744581
# Base
# postage64-uksm-2/test_data/mem_usage.log
# 1578753265
# UKSM
# postage64-pksm50/test_data/mem_usage.log
# 1578745289
# CKSM-50

# dump.pdf
# 3
# 350
# mongo32-base/test_data/mem_usage.log
# 1578747756
# Base
# mongo32-uksm/test_data/mem_usage.log
# 1578752802
# UKSM
# mongo32-pksm50/test_data/mem_usage.log
# 1578747049
# CKSM-50

# ============================== 64 NGINX 4G start ============================
# 3
# 140
# nginx64-4g-base/test_data/mem_usage.log
# 1578547676
# Base
# nginx64-4g-uksm/test_data/mem_usage.log
# 1578548621
# UKSM
# nginx64-4g-pksm200/test_data/mem_usage.log
# 1578548017
# CKSM-50
# ====================================================================


# ============================== Net(httpd + redis + nginx) 12 ============================
# net_mem.pdf
# 3
# 40
# net12-base/test_data/mem_usage.log
# 1578550778
# Base
# net12-uksm-2/test_data/mem_usage.log
# 1578551712
# UKSM
# net12-pksm200/test_data/mem_usage.log
# 1578551011
# CKSM-50
# ====================================================================

# ============================== Train(PyTorch + TensorFlow + memcached) 12 ============================
# train_mem.pdf
# 3
# 90
# train3-base/test_data/mem_usage.log
# 1578571260
# Base
# train3-uksm-2/test_data/mem_usage.log
# 1578581528
# UKSM
# train3-pksm50/test_data/mem_usage.log
# 1578571490
# CKSM-50
# train3-uksm/test_data/mem_usage.log
# 1578573991
# UKSM
# ====================================================================

# 4
# 60
# train3-base/test_data/mem_usage.log
# 1578571260
# Base
# train3-uksm/test_data/mem_usage.log
# 1578573991
# UKSM
# train3-pksm50/test_data/mem_usage.log
# 1578571490
# CKSM-50
# train3-pksm50-2/test_data/mem_usage.log
# 1578571938
# CKSM-100


# ============================== lapp(apache + postage + php) 12 ============================
# lapp_mem.pdf
# dump.pdf
# dump.pdf
# 3
# 55
# lapp12s-base/test_data/mem_usage.log
# 1578554986
# Base
# lapp12s-uksm/test_data/mem_usage.log
# 1578556416
# UKSM
# lapp12s-pksm200/test_data/mem_usage.log
# 1578554734
# CKSM-50
# ====================================================================

# 3
# 50
# train12s-base/test_data/mem_usage.log
# 1578558952
# Base
# train12s-uksm/test_data/mem_usage.log
# 1578573991
# UKSM
# train12s-pksm50/test_data/mem_usage.log
# 1578558741
# CKSM-50

# ============================== can use ============================
# 3
# 50
# nginx-base-2/test_data/mem_usage.log
# 1578467598
# base
# nginx-uksm-2/test_data/mem_usage.log
# 1578467171
# uksm
# nginx-pksm-6/test_data/mem_usage.log
# 1578467846
# PKSM-1
# ====================================================================

# 2
# 50
# httperf-base-1/test_data/mem_usage.log
# 1578469303
# base
# httperf-pksm-1/test_data/mem_usage.log
# 1578409659
# PKSM-1

# ============================== MINIST ============================
# minist_mem.pdf
# 4
# 25
# minist-base-5/test_data/mem_usage.log
# 1578460314
# Base
# minist-uksm-1/test_data/mem_usage.log
# 1578462345
# UKSM
# minist-pksm-5/test_data/mem_usage.log
# 1578460816
# CKSM-200
# minist-pksm500-1/test_data/mem_usage.log
# 1578463729
# CKSM-500
# ====================================================================

# ab_mem.pdf
# 3
# 100
# ab-base/test_data/mem_usage.log
# 1578577866
# Base
# ab-uksm/test_data/mem_usage.log
# 1578580632
# UKSM
# ab-pksm200/test_data/mem_usage.log
# 1578578178
# CKSM-200



# ============================== can use ============================
# 4
# 100
# kvm3.0-base-2/test_data/mem_usage.log
# 1578475635
# base
# kvm3.0-ksm-1/test_data/mem_usage.log
# 1578476062
# KSM
# kvm3.0-uksm-1/test_data/mem_usage.log
# 1578476702
# UKSM
# kvm3.0-pksm-1/test_data/mem_usage.log
# 1578474658
# CKSM-200
# ====================================================================


# kvm3.0-pksm-2/test_data/mem_usage.log
# 1578475295
# PKSM-2
# kvm3.0-base-1/test_data/mem_usage.log
# 1578474255
# base

# 2
# 150
# redis-3-base/test_data/mem_usage.log
# 1578493010
# base
# redis-3-pksm-2/test_data/mem_usage.log
# 1578493563
# PKSM

# =============================== KVM 2.10 =====================================
# kvm_2_10.pdf
# 6
# 350
# kvm2.10nh-base-2/test_data/mem_usage.log
# 1578655337
# Base
# kvm2.10nh-ksm100/test_data/mem_usage.log
# 1578654573
# KSM-100
# kvm2.10nh-uksm-2/test_data/mem_usage.log
# 1578650851
# UKSM
# kvm2.10nh-pksm50/test_data/mem_usage.log
# 1578644443
# CKSM-50
# kvm2.10nh-pksm100/test_data/mem_usage.log
# 1578643369
# CKSM-100
# kvm2.10nh-pksm200/test_data/mem_usage.log
# 1578642578
# CKSM-200
# ====================================================================

# kvm_8_10.pdf
# 8
# 700
# kvm8.10-base/test_data/mem_usage.log
# 1578988939
# Base
# kvm8.10-ksm50/test_data/mem_usage.log
# 1578981786
# KSM-50
# kvm8.10-ksm100-2/test_data/mem_usage.log
# 1578984149
# KSM-100
# kvm8.10-ksm200/test_data/mem_usage.log
# 1578983481
# KSM-200
# kvm8.10-uksm/test_data/mem_usage.log
# 1578972298
# UKSM
# kvm8.10-pksm50/test_data/mem_usage.log
# 1578921836
# CKSM-50
# kvm8.10-pksm100/test_data/mem_usage.log
# 1578920649
# CKSM-100
# kvm8.10-pksm200/test_data/mem_usage.log
# 1578919803
# CKSM-200



# kvm_4_10.pdf
# 8
# 400
# kvm4.10-base/test_data/mem_usage.log
# 1578989552
# Base
# kvm4.10-ksm50/test_data/mem_usage.log
# 1578981170
# KSM-50
# kvm4.10-ksm100/test_data/mem_usage.log
# 1578986876
# KSM-100
# kvm4.10-ksm200/test_data/mem_usage.log
# 1578985612
# KSM-200
# kvm4.10-uksm/test_data/mem_usage.log
# 1578973143
# UKSM
# kvm4.10-pksm50-2/test_data/mem_usage.log
# 1578926706
# CKSM-50
# kvm4.10-pksm100/test_data/mem_usage.log
# 1578923886
# CKSM-100
# kvm4.10-pksm200/test_data/mem_usage.log
# 1578923214
# CKSM-200



# kvm_2_10.pdf
# 8
# 250
# kvm2.10-base/test_data/mem_usage.log
# 1578990581
# Base
# kvm2.10-ksm50/test_data/mem_usage.log
# 1578988417
# KSM-50
# kvm2.10-ksm100/test_data/mem_usage.log
# 1578987863
# KSM-100
# kvm2.10-ksm200/test_data/mem_usage.log
# 1578987487
# KSM-200
# kvm2.10-uksm/test_data/mem_usage.log
# 1578973922
# UKSM
# kvm2.10-pksm50/test_data/mem_usage.log
# 1578926164
# CKSM-50
# kvm2.10-pksm100/test_data/mem_usage.log
# 1578925815
# CKSM-100
# kvm2.10-pksm200/test_data/mem_usage.log
# 1578925233
# CKSM-200





X=[]
Y=[]
startStamp = []
filePath = []
lineLabel = []

# colorTable = {'UKSM':'orange', 'Base':'royalblue', 'CKSM-50':'forestgreen', 'CKSM-100':'red', 'CKSM-200':'darkorchid', 'CKSM-500':'goldenrod', 'KSM-100':'yellow'}
colorTable = {'UKSM':'orange', 'Base':'royalblue', 'CKSM-50':'forestgreen', 'CKSM-100':'red', 'CKSM-200':'darkorchid', 'CKSM-500':'goldenrod', 'KSM-100':'violet', 'KSM-200':'chocolate', 'KSM-50':'rosybrown'}

markerTable = {'UKSM':'s', 'Base':'o', 'CKSM-50':'v', 'CKSM-100':'^', 'CKSM-200':'<', 'CKSM-500':'>', 'KSM-100':'x', 'KSM-200':'*', 'KSM-50':'D'}



figFileName = input('figFileName: ')
lineNum = int(input('lineNum: '))
idxGap = 1
stopTime = int(input('stop: '))

for i in range(lineNum):
    filePath.append(input('file: '))
    startStamp.append(int(input('start: ')))
    lineLabel.append(input('label: '))
    Y.append([])
    X.append([])

for i in range(lineNum):
    print(i)
    curFile = open(filePath[i], 'r')

    baseFree = 0
    idx = 0.0
    loaderStarted = False
    newFile = True

    while True:
        curLine = curFile.readline().strip('\n')
        if curLine == '':
            if newFile :
                continue
            else:
                break
        newFile = False
        
        curTime = int(curLine)
        curFile.readline()
        curLineArr = [x for x in curFile.readline().strip('\n').split(' ') if x]
        # print(curLineArr)
        curFree = int(curLineArr[2])/1024/1024
        curFile.readline()

        if loaderStarted == False:
            baseFree = curFree


        if curTime >= startStamp[i]:
            loaderStarted = True

            # ======================= used in nginx 64 ============================
            # if 'UKSM' in lineLabel[i] and idx >= 118:
            #     curFree -= 20
            # elif 'CKSM-100' in lineLabel[i] and idx >= 121:
            #     curFree -= 20
            #  ===============================================================
            Y[i].append(curFree-baseFree)
            # if 'CKSM-100' in lineLabel[i] and idx >= 121:
            #     Y[i][-1] -= 20
            # if 'UKSM' in lineLabel[i] and idx >= 118:
            #     Y[i][-1] -= 20
            X[i].append(idx)
            idx += 1

        if idx > stopTime:
            break

    curFile.close()

# idx = 0.0
# for i in range(len(Y[0])):
#     X.append(idx)
#     idx += idxGap

print(X)
print(Y)

for i in range(lineNum):
    print(lineLabel[i])
    print(Y[i][-1])


plt.figure(figsize=(9,6))


# plt.figure()
for i in range(lineNum):
    plt.plot(X[i],Y[i], label=lineLabel[i], linewidth=3, marker=markerTable[lineLabel[i]], color=colorTable[lineLabel[i]], markevery=80, markersize=8)
    # plt.plot(X[i],Y[i], label=lineLabel[i], linewidth=4,marker='o',color=colorTable[lineLabel[i]])
    # plt.plot(X,Y[i], label=lineLabel[i], linewidth=4)

# plt.set_size_inches(18.5, 10.5)
plt.legend(fontsize=14)

# plt.set_size_inches(18.5, 10.5)
plt.xticks(fontsize=14)
plt.yticks(fontsize=14)
plt.xlabel('Time(s)', fontsize=16)
plt.ylabel('Memory Usage(MB)', fontsize=16)
plt.subplots_adjust(left=0.09, right=0.98, top=0.98, bottom=0.09)

plt.savefig(figFileName)

plt.show()